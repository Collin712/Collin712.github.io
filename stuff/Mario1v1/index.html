<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Mario 1v1</title>
    <style>
        body{
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            overflow-y: hidden;
            background-color: black;
        }
        #canvas{
            width: 100vw;
            height: 100vh;
            image-rendering: pixelated;
            object-fit: contain;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width="1600" height="900"></canvas>
<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext('2d');
const groundY = 772
let backgroundImage = new Image(); backgroundImage.src = 'background.png';
let marioDeadImage = new Image(); marioDeadImage.src = 'marioDead.png';
let marioJumpImage = new Image(); marioJumpImage.src = 'marioJump.png';
let marioRunningImage = new Image(); marioRunningImage.src = 'marioRun1.png';
let marioStandingImage = new Image(); marioStandingImage.src = 'marioStanding.png';
let runAnimationTimer = 0;
let runAnimationSpeed = 10; //must be an even number
let gameStarted = false;
let frameCount = 0;
let keysHeld = {w: false, a: false, s: false, d: false, up: false, down: false, left: false, right: false}
let mario = {x: 50, y: 200, width: 60, height: 120, xSpeed: 0, ySpeed: 0, dead: false, onGround: false}
let gravity = 1;
let runSpeed = 5;
let jumpStrength = 15;
//draw the menu that shows before the game starts
backgroundImage.onload = function(){
ctx.drawImage(backgroundImage, 0, 0);
ctx.fillRect(0, 0, 1600, groundY);
ctx.font = "40px sans-serif";
ctx.fillStyle = "white";
ctx.fillText("Press Enter to Start", 585, 400);
ctx.font = "20px sans-serif";
ctx.fillText("Player 1 Controls: WASD", 650, 450);
ctx.fillText("Player 2 Controls: Arrows", 650, 480);
}

document.addEventListener("keydown", (e) => {
    if(!gameStarted && e.key === "Enter"){startGame();}
    if(e.key === "w"){keysHeld.w = true}
    if(e.key === "a"){keysHeld.a = true}
    if(e.key === "s"){keysHeld.s = true}
    if(e.key === "d"){keysHeld.d = true}
});
document.addEventListener("keyup", (e) => {
    if(e.key === "w"){keysHeld.w = false}
    if(e.key === "a"){keysHeld.a = false}
    if(e.key === "s"){keysHeld.s = false}
    if(e.key === "d"){keysHeld.d = false}
});

function startGame(){
    gameStarted = true;
    gameInterval = setInterval(gameInterval, 1000/60);
}

function gameInterval(){
    console.log(keysHeld)
    physics();
    render();
    frameCount++;
}

function physics(){
    runAnimationTimer++;
    if(runAnimationTimer === runAnimationSpeed / 2){marioRunningImage.src = 'marioRun2.png'};
    if(runAnimationTimer === runAnimationSpeed){marioRunningImage.src = 'marioRun1.png'; runAnimationTimer = 0};
    if(keysHeld.a){mario.xSpeed = -runSpeed};
    if(keysHeld.d){mario.xSpeed = runSpeed};
    if(!keysHeld.a && !keysHeld.d){mario.xSpeed = 0};
    if(keysHeld.w && mario.onGround){mario.ySpeed = -jumpStrength};
    mario.ySpeed += gravity;
    mario.x += mario.xSpeed;
    mario.y += mario.ySpeed;
    if(mario.y + mario.height >= groundY){mario.onGround = true; mario.ySpeed = 0; mario.y = (groundY - mario.height)}else{mario.onGround = false};
}

function render(){
    ctx.drawImage(backgroundImage, 0, 0);
    ctx.drawImage(marioStandingImage, mario.x, mario.y, mario.width, mario.height)
}
</script>
</body>
</html>